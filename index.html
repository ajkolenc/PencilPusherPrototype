<html>

	<head>
		<title>0</title>

		<!--Libraries-->
		<script src="ArlLib/ArlMath.js"></script>
		<script src="ArlLib/ArlPhysics.js"></script>
		<script src="ArlLib/ArlDraw.js"></script>
		<script src="ArlLib/ArlGame.js"></script>
		<script src="ArlLib/ArlEtc.js"></script>

		<script>
			//logic
			var money = 0;
			var moneyRate = 0;
			var moneyTimer = new ArlEtc.Timer(1);
			var menus = ["deskMenu", "officeMenu", "employeesMenu", "emailMenu"];
			var menuIndex = 0;

			//text
			var moneyUnit = "moneyz";

			//graphics
			var dullRed = new ArlDraw.Color(200,100,100,1);
			var dullBlue = new ArlDraw.Color(100,100,200,1);
			var darkGrey = new ArlDraw.Color(50,50,50,1);
			var scribbleList = [];
			var maxScribbleLength = 800;

			//EVENTS
			ArlGame.events.resize = function() {
				//number of pixels inside the canvas should match the number of pixels it takes up on the screen
				ArlGame.gameCanvas.width = ArlGame.gameCanvas.scrollWidth;
				ArlGame.gameCanvas.height = ArlGame.gameCanvas.scrollHeight;
			};
			ArlGame.events.onCursorDown = function() {
				scribbleList.push(new ArlMath.Point(ArlGame.cursorPos.x, ArlGame.cursorPos.y));
			};
			ArlGame.events.onCursorMove = function() {
				if (ArlGame.isCursorDown) {
					scribbleList.push(new ArlMath.Point(ArlGame.cursorPos.x, ArlGame.cursorPos.y));

					if (ArlMath.pathLength(scribbleList) > maxScribbleLength) {
						money++;
						scribbleList = [];
					}
				}
			};
			ArlGame.events.onCursorUp = function() {
				scribbleList = [];
			};
			ArlGame.events.init = function() {
				//number of pixels inside the canvas should match the number of pixels it takes up on the screen
				ArlGame.gameCanvas.width = ArlGame.gameCanvas.scrollWidth;
				ArlGame.gameCanvas.height = ArlGame.gameCanvas.scrollHeight;

				//var e = new Employee("Bob", 1000, null);
				//console.log(e.toHTML());
				//document.body.innerHTML += e.toHTML();
			};
			ArlGame.events.mainLoop = function() {
				ArlDraw.clearCanvas(ArlGame.gameCanvas);

				var curMoney = Math.floor(money + (moneyRate * moneyTimer.percentDone()));	
				document.getElementById("money").innerHTML = curMoney + " " + moneyUnit;
				document.title = curMoney;
				document.getElementById("moneyRate").innerHTML = moneyRate + " " + moneyUnit + " / second";

				if (moneyTimer.isDone()) {
					money += moneyRate;
					moneyTimer.reset();
				}

				drawPaperLines(ArlGame.context, ArlGame.gameCanvas.width, ArlGame.gameCanvas.height, 10, dullRed, dullBlue);
				ArlDraw.drawPath(ArlGame.context, scribbleList, 2, darkGrey);
			};

			//FUNCTIONS
			var drawPaperLines = function (context, width, height, numLines, color1, color2) {
				var lineSeparation = (height - (height/5)) / numLines;
				for (var i = 0; i < numLines; i++) {
					ArlDraw.drawLine(context, 0, (height/5) + (i*lineSeparation), width, (height/5) + (i*lineSeparation), 1, color2);
				}
				ArlDraw.drawLine(context, width/6, 0, width/6, height, 2, color1);
			}

			var buyUpgrade = function(cost, benefit) {
				if (money >= cost) {
					money -= cost;
					moneyRate += benefit;
				}
			}

			var getMenu = function(index) {
				return document.getElementById(menus[index]);
			}

			var switchMenu = function(index) {
				getMenu(menuIndex).style.display = "none";
				menuIndex = index;
				getMenu(menuIndex).style.display = "block";	

				if (menuIndex == 2) {

					document.getElementById("bossLevel").innerHTML = e1.toHTML(0, 30);
					document.getElementById("meLevel").innerHTML = e2.toHTML(0, 40);
					document.getElementById("employeeLevel1").innerHTML = e3.toHTML(0, 50) + e4.toHTML(30, 50) + e5.toHTML(60, 50);
				}
			}

			//OBJECTS
			var Employee = function(name, productionRate, boss) {
				this.name = name;
				this.productionRate = productionRate;
				this.boss = boss;
				if (boss != null) {
					this.boss.addEmployee(this);
				}
				this.employees = [];
			};
			Employee.prototype = {
				addEmployee: function(newEmployee) {
					this.employees.push(newEmployee);
				},
				toHTML: function(leftPos, topPos) {
					var htmlStr = "";

					htmlStr += "<div class='employeeBoxWrapper' style='color: #000; position: absolute; left: " + leftPos.toString() + "%; top: " + topPos.toString() + "%;'>";
					htmlStr += "<center>";
					htmlStr += "^<br/>";
					htmlStr += "|<br/>";
					htmlStr += "<div class='employeeBox' onclick='newEmployeeLevel(" + (topPos + 10).toString() + ");'>";
					htmlStr += this.name + "<br/>";
					htmlStr += this.productionRate + " " + moneyUnit + " / second <br/>";
					htmlStr += "</div>";
					htmlStr += "</center>";
					htmlStr += "</div>";

					return htmlStr;
				},
			}

			var newEmployeeLevel = function(topPos) {
				document.getElementById("employeesMenu").innerHTML += e7.toHTML(0, topPos) + e8.toHTML(30, topPos);
				document.getElementById("employeesMenu").style.height = (topPos + 30).toString() + "%";
			}

			//test
			var e1 = new Employee("MY BOSS", 10000, null);
			var e2 = new Employee("ME", 4500, e1);
			var e3 = new Employee("Bob", 100, e2);
			var e4 = new Employee("Sally", 10, e2);
			var e5 = new Employee("Lucy", 55, e2);
			var e6 = new Employee("Sarah", 10, e3);
			var e7 = new Employee("Leon", 55, e4);
			var e8 = new Employee("Jimmy", 10, e4);
			var e9 = new Employee("Judy", 55, e5);
			var e4 = new Employee("Joyce", 10, e5);
		</script>

		<style>
			body {
				background: #444;
				color: #aaa;
				font-family: monospace;
			}
			#money {
				font-size: 80px;
			}
			#moneyRate {
				font-size: 30px;
			}
			#menuBar {
				background: #aaa;
			}
			button {
				color: #333;
				background: #ccc;
				border: 1px solid #333;
				font-family: monospace;
				font-size: 15px;
			}
			button:hover {
				color: #ccc;
				background: #333;
			}
			.menuButton {
			}
			.menuButton:hover {
			}
			#ArlGameCanvas {
				background: #eee;
				height: 80%;
				width: 20%;
				float: left;
			}
			#shop {
				float: right;
				width: 30%;
				font-size: 30px;
			}
			.employeeBoxWrapper {
				width: 30%;
			}
			.employeeBox {
				background: #aaa;
				color: #333;
				border: 2px solid #333;
			}
			#mainContent {
				height: 60%;
				margin: 2%;
			}
			.employeeLevel {

			}
		</style>
	</head>

	<body onload="ArlGame.init()" onresize="ArlGame.resize()">
		PENCIL PUSHER
		<center>
		<div id="money">
			0 moneyz
		</div>
		<div id="moneyRate">
			0 moneyz / second
		</div>
		<div id="menuBar">
			<button class="menuButton" id="deskButton" onclick="switchMenu(0);">My Desk</button>
			<button class="menuButton" id="officeButton" onclick="switchMenu(1);">My Office</button>
			<button class="menuButton" id="employeesButton" onclick="switchMenu(2);">My Employees</button>
			<button class="menuButton" id="emailButton" onclick="switchMenu(3);">Email</button>
		</div>
		</center>


		<div id="mainContent">
			<div id="deskMenu">
				<canvas id="ArlGameCanvas">
				</canvas>
				<div id="shop">
					OFFICE SUPPLIES
					<br/>
					<button onclick="buyUpgrade(5,1);">Buy Pen (5$)</button>
					<button onclick="buyUpgrade(100,5);">Buy Typewriter (100$)</button>
					<button onclick="buyUpgrade(1500,100);">Buy Word Processor (1500$)</button>
				</div>
			</div>
			<div id="officeMenu" style="display:none;">
			</div>
			<div id="employeesMenu" style="display:none;">
				<div id="bossLevel" class="employeeLevel"></div>
				<div id="meLevel" class="employeeLevel"></div>
				<div id="employeeLevel1" class="employeeLevel"></div>
			</div>
			<div id="emailMenu" style="display:none;">
			</div>
		</div>
	</body>

</html>